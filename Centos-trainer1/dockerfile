# Use the official CentOS 7 base image
FROM centos:7

# Install required packages
RUN yum groupinstall -y "X Window System" \
    && yum install -y epel-release \
    && yum install -y \
        tigervnc-server \
        x11vnc \
        xfce4 \
        xfce4-terminal \
        firefox \
        openssh-server \
        dbus-x11 \
        libXfont \
        xorg-x11-fonts-Type1 \
        xorg-x11-fonts-misc \
    && yum clean all

# Create the VNC directory
RUN mkdir -p /root/.vnc

# Set the VNC password
RUN echo "password" | vncpasswd -f > /root/.vnc/passwd \
    && chmod 600 /root/.vnc/passwd

# Generate xstartup script
RUN echo "#!/bin/sh" > /root/.vnc/xstartup \
    && echo "exec startxfce4 &" >> /root/.vnc/xstartup \
    && chmod +x /root/.vnc/xstartup

# Start SSH server
RUN ssh-keygen -A \
    && echo "root:password" | chpasswd

# Expose VNC and SSH ports
EXPOSE 5901 22

# Start VNC server and SSH
CMD ["sh", "-c", "vncserver :1 -geometry 1280x800 -depth 24 && /usr/sbin/sshd -D"]
